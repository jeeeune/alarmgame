<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ì•Œë²„íŠ¸ ì•ŒëŒ ê²Œì„</title>
  <style>
    :root { --w: min(92vw, 560px); }

    body{
      margin:0; background:#111; color:#fff;
      font-family: system-ui, -apple-system, "Noto Sans KR", sans-serif;
      display:grid; place-items:center; min-height:100vh;
      user-select:none;
    }
    .wrap{ width:var(--w); }

    .hud{
      display:flex; justify-content:space-between; align-items:center;
      gap:8px; margin:10px 4px; font-size:14px;
    }
    .pill{
      background:rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.18);
      padding:6px 10px; border-radius:999px;
      display:inline-flex; gap:8px; align-items:center;
      white-space:nowrap;
    }
    button{
      background:rgba(255,255,255,.14);
      border:1px solid rgba(255,255,255,.22);
      color:#fff; padding:6px 12px;
      border-radius:10px; cursor:pointer;
    }

    .stage{
      position:relative;
      width:100%;
      aspect-ratio: 1 / 1;
      border-radius:18px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.18);
      box-shadow: 0 10px 30px rgba(0,0,0,.5);
      background:#222;
    }
    .bg{
      position:absolute; inset:0;
      background: url("background.png") center/cover no-repeat;
    }

    /* ì•ˆë‚´ ë¬¸êµ¬ */
    .msg{
      position:absolute; left:50%; top:10px; transform:translateX(-50%);
      padding:8px 12px;
      background: rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.18);
      border-radius: 12px;
      font-size:14px;
      white-space:nowrap;
      z-index: 5;
    }

    /* ===== ì‹œê³„ êµ¬ì¡°(ì¤‘ìš”) =====
       .clock      = ìœ„ì¹˜(translate -50,-50) ë‹´ë‹¹ (ì ˆëŒ€ í”ë“¤ë¦¬ë©´ ì•ˆ ë¨)
       .clockInner = í”ë“¤ë¦¼ ì• ë‹ˆë©”ì´ì…˜ ë‹´ë‹¹
    */
    .clock{
      position:absolute;
      width:125px; height:125px;
      cursor:pointer;
      left:0; top:0;
      transform: translate(-50%, -50%);
      touch-action: manipulation;
      z-index: 3;
    }
    .clockInner{
      width:100%; height:100%;
      transform-origin: 50% 60%;
    }
    .clock img{
      width:100%; height:100%; display:block;
    }

    /* ìš¸ë¦¼ íš¨ê³¼: clockInnerì—ë§Œ ì ìš© (ìœ„ì¹˜ transformê³¼ ì¶©ëŒ ì—†ìŒ) */
    .clock.ringing .clockInner{
      animation: shakeClock .12s infinite alternate;
      filter: drop-shadow(0 0 10px rgba(255,220,120,.55));
    }
    @keyframes shakeClock{
      from{ transform: rotate(-2deg) translateY(-1px); }
      to  { transform: rotate( 2deg) translateY( 1px); }
    }

    /* ===== ì¤‘ì•™ í° ì‹œê³„(ë°°ê²½ ì†) íˆ¬ëª… í„°ì¹˜ ì˜ì—­ ===== */
    .centerHotspot{
      position:absolute;
      left: 50%;
      top: 41%;
      width: 46%;
      height: 46%;
      transform: translate(-50%, -50%);
      border-radius: 999px;
      background: rgba(255,255,255,0);
      cursor:pointer;
      z-index: 4; /* ì‹œê³„ë³´ë‹¤ ìœ„ì—¬ì•¼ í´ë¦­ë¨ */

      /* ê°œë°œ ì¤‘ ìœ„ì¹˜ í™•ì¸ìš©: í•„ìš”ì—†ìœ¼ë©´ ì§€ì›Œë„ ë¨ */
      outline: 2px dashed rgba(255,255,255,.15);
    }

    /* ì¤‘ì•™ ìš¸ë¦¼ í‘œì‹œ: transform ê±´ë“œë¦¬ì§€ ì•Šê³  ::afterë¡œ ë¼ìš´ë“œë§Œ */
    .centerHotspot::after{
      content:"";
      position:absolute; inset:0;
      border-radius:999px;
      opacity:0;
      pointer-events:none;
    }
    .centerHotspot.ringing::after{
      opacity:1;
      box-shadow: 0 0 0 6px rgba(255,220,120,.20), 0 0 16px rgba(255,220,120,.35);
      outline: 4px solid rgba(255,220,120,.75);
      animation: pulse 0.6s infinite alternate;
    }
    @keyframes pulse{
      from{ transform: scale(0.995); }
      to  { transform: scale(1.01); }
    }

    .overlay{
      position:absolute; inset:0;
      display:none; place-items:center;
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(4px);
      z-index: 10;
    }
    .overlay.show{ display:grid; }
    .card{
      width:min(90%, 360px);
      background: rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.18);
      border-radius:18px;
      padding:16px;
      text-align:center;
    }
    .card h2{ margin:0 0 8px; }
    .card p{ margin:0 0 14px; opacity:.9; line-height:1.4; }
  </style>
</head>

<body>
  <div class="wrap">
<div class="hud">
  <div class="pill">â± <span id="time">15.0</span>s</div>
  <div class="pill">âœ… ì ìˆ˜ <span id="score">0</span></div>

  <button id="btnStart">ì‹œì‘</button>
  <button id="btnPause">ì¼ì‹œì •ì§€</button>
  <button id="btnStop">ì •ì§€</button>
</div>    <div class="stage" id="stage">
      <div class="bg"></div>
      <div class="msg" id="msg">ì‹œì‘ì„ ëˆ„ë¥´ë©´ ì•ŒëŒì´ ìš¸ë ¤!</div>

      <div class="centerHotspot" id="centerHotspot" title="ì¤‘ì•™ ì‹œê³„"></div>

      <div class="overlay" id="overlay">
        <div class="card">
          <h2>ê²Œì„ ë!</h2>
          <p id="overDesc">ì ìˆ˜: 0</p>
          <button id="btnRestart">ë‹¤ì‹œí•˜ê¸°</button>
        </div>
      </div>
    </div>
  </div>

<script>
(() => {
  const stage = document.getElementById("stage");
  const timeEl = document.getElementById("time");
  const scoreEl = document.getElementById("score");
  const msgEl = document.getElementById("msg");
  const overlay = document.getElementById("overlay");
  const overDesc = document.getElementById("overDesc");
  const btnStart = document.getElementById("btnStart");
  const btnRestart = document.getElementById("btnRestart");
  const centerHotspot = document.getElementById("centerHotspot");
const btnPause = document.getElementById("btnPause");
const btnStop  = document.getElementById("btnStop");

  // ===== ì„¤ì • =====
  const CONFIG = {
    timeLimit: 15,
    clocks: 11,
    ringingMin: 1,
    ringingMax: 3,
    wrongPenalty: 0.6,
    centerChance: 0.30,       // í…ŒìŠ¤íŠ¸ìš©: ì¤‘ì•™ í•­ìƒ ìš¸ë¦¼ (ì›í•˜ë©´ 0.2ë¡œ)
    centerTapsToStop: 2,
    beepIntervalMs: 350
  };

  // ë„¤ê°€ ì°ì€ 12ê°œ ì¢Œí‘œ(í¼ì„¼íŠ¸)
  const SLOTS = [
    {x: 14.8, y: 14.6},
    {x: 16.7, y: 32.5},
    {x: 14.8, y: 46.9},
    {x: 24.3, y: 63.2},
    {x: 15.0, y: 79.1},
    {x: 60.6, y: 69.9},
    {x: 82.1, y: 73.1},
    {x: 85.1, y: 62.2},
    {x: 86.7, y: 47.6},
    {x: 80.3, y: 31.0},
    {x: 82.6, y: 15.4},
  ];

  // ===== ì˜¤ë””ì˜¤(ì¢…ì´ í´ë¦­) =====
  let audioCtx = null;
  let clickTimer = null;

  function ensureAudio(){
    if(!audioCtx){
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    }
    if(audioCtx.state === "suspended") audioCtx.resume();
  }

  function paperClick(){
    if(!audioCtx) return;
    const noise = audioCtx.createBufferSource();
    const buffer = audioCtx.createBuffer(1, 2205, 44100);
    const data = buffer.getChannelData(0);

    for(let i=0; i<data.length; i++){
      data[i] = (Math.random() * 2 - 1) * (1 - i/data.length);
    }
    noise.buffer = buffer;

    const filter = audioCtx.createBiquadFilter();
    filter.type = "highpass";
    filter.frequency.value = 1400;

    const gain = audioCtx.createGain();
    gain.gain.value = 0.14;

    noise.connect(filter).connect(gain).connect(audioCtx.destination);
    noise.start();
  }

  function startBeepLoop(){
    stopBeepLoop();
    paperClick();
    clickTimer = setInterval(() => paperClick(), CONFIG.beepIntervalMs);
  }
  function stopBeepLoop(){
    if(clickTimer) clearInterval(clickTimer);
    clickTimer = null;
  }

  // ===== ê²Œì„ ìƒíƒœ =====
  let clockEls = [];
  let ringing = new Set();
  let centerRinging = false;
  let centerTapLeft = CONFIG.centerTapsToStop;

  let timeLeft = CONFIG.timeLimit;
  let score = 0;
  let running = false;
  let paused = false;
  let lastTs = null;
  let rafId = null;

  function setMsg(t){ msgEl.textContent = t; }

  // ì´ë¯¸ì§€ ë¡œë”©ì´ ì™„ë£Œë¼ì•¼ â€œì í”„â€ê°€ ì•ˆ ìƒê²¨ì„œ, startGameì—ì„œ ê¸°ë‹¤ë¦¼
  function preloadClocks(){
    const promises = [];
    for(let i=1;i<=CONFIG.clocks;i++){
      const src = `clock_${String(i).padStart(2,"0")}.png`;
      promises.push(new Promise((resolve) => {
        const im = new Image();
        im.onload = () => resolve();
        im.onerror = () => resolve(); // ì—†ì–´ë„ ê²Œì„ì€ ëŒê²Œ
        im.src = src;
      }));
    }
    return Promise.all(promises);
  }

  function clearClocks(){
    clockEls.forEach(el => el.remove());
    clockEls = [];
  }

  function createClocks(){
    clearClocks();
    for(let i=1;i<=CONFIG.clocks;i++){
      const el = document.createElement("div");
      el.className = "clock";
      el.dataset.idx = String(i-1);

      const inner = document.createElement("div");
      inner.className = "clockInner";

      const img = document.createElement("img");
      img.src = `clock_${String(i).padStart(2,"0")}.png`;
      img.alt = `clock_${i}`;

      inner.appendChild(img);
      el.appendChild(inner);

      el.addEventListener("pointerdown", (e) => {
        e.preventDefault();
        ensureAudio();
        onClockTap(i-1);
      });

      stage.appendChild(el);
      clockEls.push(el);
    }
  }

  function placeClocksRandom(){
    const slots = [...SLOTS].sort(() => Math.random() - 0.5);

    // âœ… ë ˆì´ì•„ì›ƒì´ ì•ˆì •ëœ ë‹¤ìŒ í”„ë ˆì„ì— ë°°ì¹˜(ì í”„ ë°©ì§€)
    requestAnimationFrame(() => {
      clockEls.forEach((el, idx) => {
        const s = slots[idx];
        el.style.left = `${s.x}%`;
        el.style.top  = `${s.y}%`;
      });
    });
  }

  function pickRinging(){
    ringing.clear();
    clockEls.forEach(el => el.classList.remove("ringing"));
    centerHotspot.classList.remove("ringing");
    centerRinging = false;
    centerTapLeft = CONFIG.centerTapsToStop;

    const count = randInt(CONFIG.ringingMin, CONFIG.ringingMax);
    while(ringing.size < count){
      ringing.add(Math.floor(Math.random() * CONFIG.clocks));
    }
    for(const idx of ringing){
      clockEls[idx].classList.add("ringing");
    }

    if(Math.random() < CONFIG.centerChance){
      centerRinging = true;
      centerHotspot.classList.add("ringing");
    }

    startBeepLoop();
    setMsg("ğŸ”Š ìš¸ë¦¬ëŠ” ì‹œê³„ë¥¼ ëª¨ë‘ ëˆŒëŸ¬ì„œ êº¼!");
  }

  function onClockTap(idx){
    if(!running) return;
    if(paused) return;

    if(ringing.has(idx)){
      ringing.delete(idx);
      clockEls[idx].classList.remove("ringing");
      score += 1;
      scoreEl.textContent = String(score);

      if(ringing.size === 0 && !centerRinging){
        nextRound();
      }
    } else {
      timeLeft = Math.max(0, timeLeft - CONFIG.wrongPenalty);
      timeEl.textContent = timeLeft.toFixed(1);
      setMsg("âŒ ì•„ëƒ! (ì‹œê°„ -0.6ì´ˆ)");
    }
  }

  centerHotspot.addEventListener("pointerdown", (e) => {
    e.preventDefault();
    ensureAudio();
    if(!running) return;
    if(paused) return;

    if(!centerRinging){
      timeLeft = Math.max(0, timeLeft - CONFIG.wrongPenalty);
      timeEl.textContent = timeLeft.toFixed(1);
      setMsg("âŒ ì¤‘ì•™ì€ ì§€ê¸ˆ ì•ˆ ìš¸ë ¤! (ì‹œê°„ -0.6ì´ˆ)");
      return;
    }

    centerTapLeft -= 1;
    if(centerTapLeft > 0){
      setMsg("ì¤‘ì•™ ì‹œê³„! í•œ ë²ˆ ë”!");
      return;
    }

    centerRinging = false;
    centerHotspot.classList.remove("ringing");
    score += 2;
    scoreEl.textContent = String(score);

    if(ringing.size === 0){
      nextRound();
    } else {
      setMsg("âœ… ì¤‘ì•™ ê»ì–´! ë‚˜ë¨¸ì§€ë„ êº¼!");
    }
  });

  function nextRound(){
    stopBeepLoop();
    placeClocksRandom();
    pickRinging();
  }

  async function startGame(){
  overlay.classList.remove("show");
  running = true;
  paused = false;
  setButtons();
    score = 0;
    timeLeft = CONFIG.timeLimit;
    scoreEl.textContent = "0";
    timeEl.textContent = timeLeft.toFixed(1);

    ensureAudio();

    await preloadClocks();     // âœ… ì í”„/ê¹œë¹¡ì„ ìµœì†Œí™”
    createClocks();
    placeClocksRandom();
    pickRinging();

    lastTs = null;
    cancelAnimationFrame(rafId);
    rafId = requestAnimationFrame(tick);
  }

  function endGame(){
    running = false;
    stopBeepLoop();
    overlay.classList.add("show");
    overDesc.textContent = `ì ìˆ˜: ${score}`;
    setMsg("ë‹¤ì‹œí•˜ê¸°ë¥¼ ëˆŒëŸ¬!");
  }

  function tick(ts){
    if(!running) return;
    if(lastTs == null) lastTs = ts;
    const dt = (ts - lastTs)/1000;
    lastTs = ts;

    timeLeft -= dt;
    if(timeLeft <= 0){
      timeLeft = 0;
      timeEl.textContent = "0.0";
      endGame();
      return;
    }
    timeEl.textContent = timeLeft.toFixed(1);
    rafId = requestAnimationFrame(tick);
  }

  function randInt(a,b){
    return Math.floor(Math.random()*(b-a+1))+a;
  }

  btnStart.addEventListener("click", startGame);
  btnRestart.addEventListener("click", startGame);
function setButtons(){
  // ì‹¤í–‰ ì¤‘ ì•„ë‹ ë•Œ: Pause/Stop ë¹„í™œì„±
  btnPause.disabled = !running;
  btnStop.disabled  = !running;

  // ì¼ì‹œì •ì§€ ìƒíƒœë©´ ë²„íŠ¼ ê¸€ì ë°”ê¾¸ê¸°
  btnPause.textContent = paused ? "ê³„ì†í•˜ê¸°" : "ì¼ì‹œì •ì§€";
}

function pauseToggle(){
  if(!running) return;

  paused = !paused;

  if(paused){
    // ì‹œê°„ ë©ˆì¶”ê³ , ì†Œë¦¬ë„ ë©ˆì¶”ê¸°
    stopBeepLoop();
    cancelAnimationFrame(rafId);
    setMsg("â¸ï¸ ì¼ì‹œì •ì§€");
  }else{
    // ë‹¤ì‹œ ì‹œì‘(ì‹œê°„ ê³„ì‚° ì¬ì‹œì‘)
    lastTs = null;

    // ìš¸ë¦¬ëŠ” ê²Œ ìˆìœ¼ë©´ ì†Œë¦¬ ë‹¤ì‹œ
    if(ringing.size > 0 || centerRinging){
      startBeepLoop();
    }

    rafId = requestAnimationFrame(tick);
    setMsg("â–¶ï¸ ê³„ì†!");
  }

  setButtons();
}

function stopGame(){
  // ì™„ì „ ì¤‘ì§€(ì²˜ìŒ ìƒíƒœë¡œ)
  running = false;
  paused = false;
  stopBeepLoop();
  cancelAnimationFrame(rafId);

  // ìš¸ë¦¼ í‘œì‹œ ì œê±°
  ringing.clear();
  clockEls.forEach(el => el.classList.remove("ringing"));
  centerHotspot.classList.remove("ringing");
  centerRinging = false;

  // í™”ë©´ ì •ë¦¬
  overlay.classList.remove("show");
  clearClocks();

  // ìˆ˜ì¹˜ ë¦¬ì…‹(ì›í•˜ë©´ ì‹œê°„/ì ìˆ˜ ìœ ì§€ë„ ê°€ëŠ¥í•˜ì§€ë§Œ, ì¼ë‹¨ ê¹”ë”í•˜ê²Œ ë¦¬ì…‹)
  score = 0;
  timeLeft = CONFIG.timeLimit;
  scoreEl.textContent = "0";
  timeEl.textContent = timeLeft.toFixed(1);

  setMsg("â¹ ì •ì§€ë¨. ì‹œì‘ì„ ëˆ„ë¥´ë©´ ë‹¤ì‹œ ì‹œì‘!");
  setButtons();
}

// ë²„íŠ¼ ì—°ê²°
btnPause.addEventListener("click", pauseToggle);
btnStop.addEventListener("click", stopGame);

// ì‹œì‘/ì¬ì‹œì‘ í•¨ìˆ˜ ë§¨ ëì— ì´ ì¤„ ì¶”ê°€í•˜ë©´ ë²„íŠ¼ ìƒíƒœê°€ ë§ì¶°ì§
// setButtons();

setMsg("ì‹œì‘ì„ ëˆŒëŸ¬!");
setButtons();
})();
</script>
</body>

</html>

